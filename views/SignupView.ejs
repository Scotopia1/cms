<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register Company - Project Management CMS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .form-container {
            max-width: 680px; /* Wider for more fields */
        }
        .section-title {
            border-bottom: 1px solid #e5e7eb; /* Gray-200 */
            padding-bottom: 0.75rem; /* pb-3 */
            margin-bottom: 1.5rem; /* mb-6 */
            font-size: 1.25rem; /* text-xl */
            font-weight: 600; /* font-semibold */
            color: #374151; /* Gray-700 */
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 to-slate-700 min-h-screen flex flex-col items-center justify-center py-12 px-4">

<div class="form-container w-full bg-white p-8 sm:p-10 rounded-xl shadow-2xl">
    <div class="text-center mb-8">
        <i class="fas fa-building text-5xl text-purple-600 mb-3"></i>
        <h1 class="text-3xl font-bold text-gray-800">Register Your Company</h1>
        <p class="text-gray-600">Join us and start managing your projects efficiently.</p>
    </div>

    <form id="companyRegistrationForm" class="space-y-8">
        <div>
            <h2 class="section-title">Company Details</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-5">
                <div>
                    <label for="companyName" class="block text-sm font-medium text-gray-700 mb-1">Company Name <span class="text-red-500">*</span></label>
                    <input type="text" id="companyName" name="companyName" placeholder="e.g., Innovatech Ltd." class="w-full px-3 py-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition duration-150" required>
                </div>
                <div>
                    <label for="companyIndustry" class="block text-sm font-medium text-gray-700 mb-1">Industry</label>
                    <input type="text" id="companyIndustry" name="companyIndustry" placeholder="e.g., Technology" class="w-full px-3 py-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition duration-150">
                </div>
                <div>
                    <label for="companyLocation" class="block text-sm font-medium text-gray-700 mb-1">Location / Address</label>
                    <input type="text" id="companyLocation" name="companyLocation" placeholder="e.g., 123 Tech Street, Innovation City" class="w-full px-3 py-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition duration-150">
                </div>
                <div>
                    <label for="companyContact" class="block text-sm font-medium text-gray-700 mb-1">Contact Info (Phone/Email)</label>
                    <input type="text" id="companyContact" name="companyContact" placeholder="e.g., +1-555-1234 / contact@company.com" class="w-full px-3 py-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition duration-150">
                </div>
                <div class="md:col-span-2">
                    <label for="companyWebsite" class="block text-sm font-medium text-gray-700 mb-1">Website</label>
                    <input type="url" id="companyWebsite" name="companyWebsite" placeholder="https://www.yourcompany.com" class="w-full px-3 py-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition duration-150">
                </div>
            </div>
        </div>

        <div>
            <h2 class="section-title">Administrator Account</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-5">
                <div>
                    <label for="adminName" class="block text-sm font-medium text-gray-700 mb-1">Full Name <span class="text-red-500">*</span></label>
                    <input type="text" id="adminName" name="adminName" placeholder="e.g., Jane Doe" class="w-full px-3 py-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition duration-150" required>
                </div>
                <div>
                    <label for="adminPosition" class="block text-sm font-medium text-gray-700 mb-1">Position / Role <span class="text-red-500">*</span></label>
                    <input type="text" id="adminPosition" name="adminPosition" placeholder="e.g., CEO, Project Manager" class="w-full px-3 py-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition duration-150" required>
                </div>
                <div>
                    <label for="adminEmail" class="block text-sm font-medium text-gray-700 mb-1">Email Address <span class="text-red-500">*</span></label>
                    <input type="email" id="adminEmail" name="adminEmail" placeholder="you@example.com" class="w-full px-3 py-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition duration-150" required>
                </div>
                <div>
                    <label for="adminPassword" class="block text-sm font-medium text-gray-700 mb-1">Password <span class="text-red-500">*</span></label>
                    <input type="password" id="adminPassword" name="adminPassword" placeholder="••••••••" class="w-full px-3 py-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition duration-150" required>
                </div>
            </div>
        </div>

        <div class="pt-2">
            <button type="submit" id="registerButton" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-base font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition duration-150">
                <i class="fas fa-user-plus mr-2"></i>Create Account
            </button>
        </div>
    </form>

    <div id="messageBox" class="mt-6 text-center text-sm"></div>

    <p class="mt-8 text-center text-sm text-gray-600">
        Already have an account?
        <a href="../ui/login" class="font-medium text-purple-600 hover:text-purple-500">Sign In</a>
    </p>
</div>

<script>
    const registrationForm = document.getElementById('companyRegistrationForm');
    const registerButton = document.getElementById('registerButton');
    const messageBox = document.getElementById('messageBox');

    registrationForm.addEventListener('submit', async (event) => {
        event.preventDefault();
        messageBox.textContent = '';
        messageBox.className = 'mt-6 text-center text-sm'; // Reset classes
        registerButton.disabled = true;
        registerButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Creating Account...';

        const companyData = {
            Name: document.getElementById('companyName').value,
            Location: document.getElementById('companyLocation').value,
            ContactInfo: document.getElementById('companyContact').value,
            Industry: document.getElementById('companyIndustry').value,
            Website: document.getElementById('companyWebsite').value,
        };

        const adminUserData = {
            Name: document.getElementById('adminName').value,
            Email: document.getElementById('adminEmail').value,
            Password: document.getElementById('adminPassword').value,
            Position: document.getElementById('adminPosition').value,
        };

        console.log("Creating company...");

        const createcompany = await fetch('../api/company/register', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: {
                Name: companyData.Name,
                Location: companyData.Location,
                ContactInfo: companyData.ContactInfo,
                Industry: companyData.Industry,
                Website: companyData.Website,
            },
        });
        console.log("new company created!");

        const newCompany = await fetch('../api/cms/companies', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
        });
        console.log("new company get!");

        let companyId;

        for (let i = 0; i < newCompany.length; i++) {
            if (newCompany[i].Name === companyData.Name) {
                companyId = newCompany[i].CompanyID;
            }
        }

        const createAdminUser = await fetch('../api/cms/company/members', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'CompanyID': companyId,
            },
            body: {
                Name: adminUserData.Name,
                Email: adminUserData.Email,
                Password: adminUserData.Password,
                Position: adminUserData.Position,
            },
        });
        console.log("new admin user created!");

        const newAdminUser = await fetch('../api/cms/company/members', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'name': adminUserData.Name,
            },
        });
        console.log("new admin user get!");

        const applyAdminUser = await fetch('../api/cms/companies/set-admin/', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'CompanyID': companyId,
            },
            body: {
                AdminID: newAdminUser[0].MemberID,
            },
        });
        console.log("new admin user set!");
    });
</script>
</body>
</html>